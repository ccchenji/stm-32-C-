C51 COMPILER V9.00   MAIN                                                                  11/01/2017 19:19:34 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: D:\KEIL4___MDK5\MDK\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          /*---------------------------------------------------------------
   2                      摇摇棒例程
   3          
   4          接口：D1-D8   对应  P1.0-P1.7
   5                D9-D16  对应  P2.7-P2.0
   6              水银开关  对应  INT1 P3.3
   7              按键      对应  INT0 P3.2
   8          
   9                  大学生电子创新创业实践基地
  10          ---------------------------------------------------------------*/
  11          #include <reg52.h>
  12          #define uchar unsigned char
  13          #define uint unsigned int    //宏定义
  14          
  15          sbit KEY=P3^2;      //定义画面切换按键  // 水银开关  P33 按键 p32
  16          uchar KY;       //KY作用在后面说明     
  17          uchar disp=0;       //显示汉字指针
  18          uchar pic=0,num=0;     //pic为按键次数；num为中断次数
  19          
  20          uchar code text[] = {
  21          
  22          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x02,0x40,0x02,0x40,0xFE,0x7F,
  23          0x00,0x40,0x00,0x40,0x00,0x00,0x00,0x00,0x00,0x00,0x02,0x40,0x02,0x40,0xFE,0x7F,
  24          0x00,0x40,0x00,0x40,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x70,0x00,
  25          0xF8,0x00,0xFC,0x01,0xFE,0x03,0xFE,0x07,0xFE,0x0F,0xFC,0x1F,0xF8,0x3F,0xF0,0x7F,
  26          0xF0,0xFF,0xF0,0x7F,0xF8,0x3F,0xFC,0x1F,0xFE,0x0F,0xFE,0x07,0xFE,0x03,0xFC,0x01,
  27          0xF8,0x00,0x70,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x02,0x40,0x02,0x40,0xFE,0x7F,
  28          0x00,0x40,0x00,0x40,0x00,0x00,0x02,0x7F,0x02,0x41,0x02,0x41,0x02,0x41,0xFE,0x41,
  29          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,/*"?????",0*/
  30          
  31          };
  32          
  33          
  34          
  35          uchar code text2[] = {
  36          
  37          
  38          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x02,0x40,0x02,0x40,0xFE,0x7F,
  39          0x00,0x40,0x00,0x40,0x00,0x00,0x00,0x00,0x00,0x00,0x02,0x40,0x02,0x40,0xFE,0x7F,
  40          0x00,0x40,0x00,0x40,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x70,0x00,
  41          0xF8,0x00,0xFC,0x01,0xFE,0x03,0xFE,0x07,0xFE,0x0F,0xFC,0x1F,0xF8,0x3F,0xF0,0x7F,
  42          0xF0,0xFF,0xF0,0x7F,0xF8,0x3F,0xFC,0x1F,0xFE,0x0F,0xFE,0x07,0xFE,0x03,0xFC,0x01,
  43          0xF8,0x00,0x70,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x02,0x40,0x02,0x40,0xFE,0x7F,
  44          0x00,0x40,0x00,0x40,0x00,0x00,0x02,0x7F,0x02,0x41,0x02,0x41,0x02,0x41,0xFE,0x41,
  45          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,/*"?????",0*/
  46           };
  47          
  48          uchar code loveyou[] = {
  49          
  50          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x02,0x40,0x02,0x40,0xFE,0x7F,
  51          0x00,0x40,0x00,0x40,0x00,0x00,0x00,0x00,0x00,0x00,0x02,0x40,0x02,0x40,0xFE,0x7F,
  52          0x00,0x40,0x00,0x40,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x70,0x00,
  53          0xF8,0x00,0xFC,0x01,0xFE,0x03,0xFE,0x07,0xFE,0x0F,0xFC,0x1F,0xF8,0x3F,0xF0,0x7F,
  54          0xF0,0xFF,0xF0,0x7F,0xF8,0x3F,0xFC,0x1F,0xFE,0x0F,0xFE,0x07,0xFE,0x03,0xFC,0x01,
  55          0xF8,0x00,0x70,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x02,0x40,0x02,0x40,0xFE,0x7F,
C51 COMPILER V9.00   MAIN                                                                  11/01/2017 19:19:34 PAGE 2   

  56          0x00,0x40,0x00,0x40,0x00,0x00,0x02,0x7F,0x02,0x41,0x02,0x41,0x02,0x41,0xFE,0x41,
  57          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,/*"?????",0*/
  58          };
  59          
  60          uchar code picture[] = {
  61          
  62          
  63          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x02,0x40,0x02,0x40,0xFE,0x7F,
  64          0x00,0x40,0x00,0x40,0x00,0x00,0x00,0x00,0x00,0x00,0x02,0x40,0x02,0x40,0xFE,0x7F,
  65          0x00,0x40,0x00,0x40,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x70,0x00,
  66          0xF8,0x00,0xFC,0x01,0xFE,0x03,0xFE,0x07,0xFE,0x0F,0xFC,0x1F,0xF8,0x3F,0xF0,0x7F,
  67          0xF0,0xFF,0xF0,0x7F,0xF8,0x3F,0xFC,0x1F,0xFE,0x0F,0xFE,0x07,0xFE,0x03,0xFC,0x01,
  68          0xF8,0x00,0x70,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x02,0x40,0x02,0x40,0xFE,0x7F,
  69          0x00,0x40,0x00,0x40,0x00,0x00,0x02,0x7F,0x02,0x41,0x02,0x41,0x02,0x41,0xFE,0x41,
  70          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,/*"?????",0*/
  71          };
  72          /*****函数声明*****/
  73          void display_ltor(void);
  74          void display2_ltor(void);
  75          void display3(void);
  76          void display4(void);
  77          
  78          /*****n（us）延时子程序*****/
  79          void DelayUs(uint N)
  80          {
  81   1       uint x;
  82   1       for(x=0; x<=1*N;x++);
  83   1      }
  84          
  85          /*****中断服务程序*****/
  86          void intersvr0(void) interrupt 2 
  87          {
  88   1       KY=~KY;      //每个摇动来回水银开关会在摆幅两端分别产生下降沿中断，只提取其中一次（从左向右摇才显示）
  89   1       if(KY==0)
  90   1       {
  91   2         num++;     //计算中断次数
  92   2         switch(pic)      //选择画面
  93   2         {   case 0:{display_ltor();}break;
  94   3             case 1:{display2_ltor();}break;
  95   3             case 2:{display3();}break;
  96   3           case 3:{display4();}break;
  97   3             default:{display2_ltor();}  
  98   3         }
  99   2       }
 100   1      }
 101          
 102          void display_ltor(void)
 103          {
 104   1      
 105   1      uchar i;
 106   1      uchar d;
 107   1       if(num>5){disp++;num=0;}     //12个汉字分为3次显示完（每次显示4个），每中断10次切换
 108   1       if(disp>1)disp=0;
 109   1        DelayUs(5300);     //此处延时时间依各硬件差别而各不相同，试着调整使得显示内容居中即可
 110   1       for(i=0;i<64;i++)
 111   1       {
 112   2           d= ~text[disp*128+i*2+1];
 113   2           P2=~text[disp*128+i*2];
 114   2         d=((d<<4)|(d>>4));
 115   2         d=(((d<<2)&0xcc)|((d>>2)&0x33));
 116   2         d=(((d<<1)&0xaa)|((d>>1)&0x55));
 117   2           P0=d;
C51 COMPILER V9.00   MAIN                                                                  11/01/2017 19:19:34 PAGE 3   

 118   2           DelayUs(120);
 119   2       }
 120   1      
 121   1      }
 122          void display2_ltor(void)
 123          {
 124   1      
 125   1      uchar i;
 126   1      uchar d;
 127   1       if(num>5){disp++;num=0;}     //12个汉字分为3次显示完（每次显示4个），每中断10次切换
 128   1       if(disp>2)disp=0;
 129   1        DelayUs(5300);     //此处延时时间依各硬件差别而各不相同，试着调整使得显示内容居中即可
 130   1       for(i=0;i<64;i++)
 131   1       {
 132   2           d= ~text2[disp*128+i*2+1];
 133   2           P2=~text2[disp*128+i*2];
 134   2         d=((d<<4)|(d>>4));
 135   2         d=(((d<<2)&0xcc)|((d>>2)&0x33));
 136   2         d=(((d<<1)&0xaa)|((d>>1)&0x55));
 137   2           P0=d;
 138   2           DelayUs(120);
 139   2       }
 140   1      
 141   1      }
 142          /*****显示子程序3（心形图案）*****/
 143          void display3(void)
 144          {
 145   1       uchar i;
 146   1        uchar d;
 147   1        DelayUs(5200);
 148   1       for(i=0;i<64;i++)
 149   1       {   
 150   2           d=~loveyou[i*2+1];
 151   2           P2=~loveyou[i*2];
 152   2         d=((d<<4)|(d>>4));
 153   2         d=(((d<<2)&0xcc)|((d>>2)&0x33));
 154   2         d=(((d<<1)&0xaa)|((d>>1)&0x55));
 155   2           P0=d;
 156   2           DelayUs(120);
 157   2       }
 158   1      }
 159          
 160          void display4(void)
 161          {
 162   1      
 163   1      uchar i;
 164   1      uchar d;
 165   1       if(num>2){disp++;num=0;}     //12个汉字分为3次显示完（每次显示4个），每中断10次切换
 166   1       if(disp>1)disp=0;
 167   1        DelayUs(5300);     //此处延时时间依各硬件差别而各不相同，试着调整使得显示内容居中即可
 168   1       for(i=0;i<64;i++)
 169   1       {
 170   2           d= ~picture[disp*96+i*2+1];
 171   2           P2=~picture[disp*96+i*2];
 172   2         d=((d<<4)|(d>>4));
 173   2         d=(((d<<2)&0xcc)|((d>>2)&0x33));
 174   2         d=(((d<<1)&0xaa)|((d>>1)&0x55));
 175   2           P0=d;
 176   2           DelayUs(120);
 177   2       }
 178   1      
 179   1      }
C51 COMPILER V9.00   MAIN                                                                  11/01/2017 19:19:34 PAGE 4   

 180          /*****主函数*****/
 181          void main(void)
 182          {
 183   1       IT1=1;
 184   1       EX1=1;
 185   1       EA=1;      //开中断，下降沿中断
 186   1       KY=0;
 187   1       KEY=1;
 188   1       while(1)     //主程序中只检测按键
 189   1       {
 190   2        if(KEY==0)     //画面切换键按下
 191   2        {
 192   3           DelayUs(5000);     //按键去抖
 193   3           if(KEY==0);
 194   3           pic++;
 195   3           while(KEY==0);
 196   3        }
 197   2        if(pic>3)pic=0;
 198   2       }
 199   1      }
 200          /*****END*****/
 201          
 202            


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    556    ----
   CONSTANT SIZE    =    512    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      4    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
